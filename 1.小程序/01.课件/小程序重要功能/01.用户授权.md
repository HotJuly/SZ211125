# 用户授权

1. 截至到22/5/11为止,一共出现了3种授权方法
2. 用户首次登录授权
   1. 早期
      1. API:wx.getUserInfo()
      2. 该版本由于API滥用,都在onLoad中就是用该API,导致用户还没能看到页面,就需要允许授权,最终导致小程序推广难度提高,微信官方将该版本废弃
   2. 中期
      1. 使用时间最长的版本
      2. 组件:button
      3. 流程:
         1. 给button组件添加标签属性open-type,属性值为"getUserInfo"
            1. 用处:当用户点击该按钮的时候,可以弹出授权窗口
         2. 给button组件绑定事件,事件名:getuserinfo,并添加回调函数
            1. 当用户点击拒绝或者允许都会触发该事件的回调函数
         3. 通过回调函数的形参,可以获取到用户相关的信息
            1. 获取数据的位置:event.detail.userInfo
         4. 将获取到的数据更新到data中,最后在wxml中进行使用即可
      4. 注意:
         1. 该方法由于已经废弃,所以必须将基础库版本调至2.15.0以下
   3. 最新
      1. API:wx.getUserProfile(Object object)
      2. 调用该API可以弹出授权窗口,获取用户个人信息
      3. 流程:
         1. 给页面上任意标签绑定tap事件
         2. 在事件回调函数中,调用该API,就可以获取到用户个人信息
      4. 注意点:
         1. desc属性必填,该属性只能填写文本内容
         2. 每次调用这个API都会弹出授权窗口询问用户获取数据
         3. 无法实现二次登录免授权,因为wx.getUserInfo这个API已经废弃
            1. 公司逻辑:将本轮获取到的用户信息缓存到用户手机中,在下次进入项目的时候,获取上次的信息进行展示
            2. 缺点:由于缓存的是上一次的数据,所以数据的时效性较差,可能出现数据不同步的情况
            3. 公司解决方案:如果非重要功能,就使用缓存,如果涉及到重要功能,就会重新获取一次最新数据
3. 用户二次登录免授权(又称为**静默登录**)
   1. 趁用户不注意,在js中帮助用户进行登录
   2. 需求:当用户进入首页的时候,自动获取到用户的信息,并进行展示
   3. 拆解:
      1. 当用户进入首页的时候
         1. 通过生命周期来监视用户是否进入了首页
         2. 选择使用onLoad
      2. 自动获取到用户的信息
         1. 通过js的API获取到用户的信息
         2. API:wx.getUserInfo(Object object)
         3. 通过成功回调函数,可以获取到当前用户的个人信息,detail对象
      3. 进行展示
         1. 将数据存入到data对象中就能实现
   4. 注意:
      1. 当前方法在2021/4/10正式废弃,但是目前还是可以使用,只是获取到的数据是默认数据
      2. 该API只能在用户已经经过首次登录授权的情况下才能使用
4. 奇特的组件
   1. 组件:open-data
   2. 这是一个很鸡肋的组件,该组件只能看,不能用
   3. 该组件由于过于鸡肋,所以即将废弃